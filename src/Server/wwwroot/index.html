<html>

<head>
    <title>Url Shortner</title>
    <!-- JS to submit url to /api/generate and display the result in #result element -->
    <script>
        function submitUrl() {
            var url = document.getElementById("url").value;
            var request = new XMLHttpRequest();
            request.open("POST", "/api/generate", true);
            request.setRequestHeader("Content-Type", "application/json");
            request.onreadystatechange = function () {
                if (request.readyState === 4 && request.status === 200) {
                    var response = request.responseText;
                    var shortcode = response.replace(/['"]+/g, '');
                    var shorturl = window.location.origin + "/" + shortcode;
                    document.getElementById("result").innerHTML = `<a href="${shorturl}">${shorturl}</a>`;
                    document.getElementById("url").value = "";
                }
            };
            request.send(JSON.stringify({ url: url }));
        }

        window.onload = function () {
            document.getElementById("submit").addEventListener("click", submitUrl);

            // get the domain name only
            var hostname = window.location.hostname.split('.').slice(-2).join('.');

            // hostnameparts
            var hostnameparts = hostname.split('.');

            if (hostnameparts.length == 1) {
                hostname = hostnameparts[0].toLowerCase();
            } else if (hostnameparts.length == 2) {
                hostname = hostnameparts[0].toLowerCase() + "." + hostnameparts[1].toUpperCase();
            }

            // set the hostname in the title
            document.getElementById("host").innerHTML = hostname;
        };
    </script>
</head>

<body>
    <!-- span is always all caps -->
    <h1><span id="host" style="color: #0c5fac"></span> <i style="color: #3f3f3f">url shortener</i></h1>
    <i>No Ads, No Third Party Trackers, and no BS.</i>
    <br />
    <br />
    <!-- Submit form to api/generate -->
    <div>
        <input type="text" id="url" name="url" placeholder="Enter URL">
        <input type="button" id="submit" value="Shorten">
    </div>
    <br />
    <div id="result"></div>
</body>

</html>